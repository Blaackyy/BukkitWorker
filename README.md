Gonna recode this to fix some bugs.
